# title: Charge relaxation in an isolated conducting column using GfsElectroAxi.
#
# Description :
#
# A conducting rigid cylinder of radius $R_o=0.1$ is inmmersed in a isolated medium. Initially, 
# an uniform charge volume density is set in the cylinder  ($\rho_e (mathbf{x},0)=0.5$).   
# As time proceeds the charge migrates from the bulk to the interface of 
# the cylinder but the total charge in the cylinder section is preserved (see figure \ref{charge}).
# $$
# Q(t)= \int_{Section} \rho_e(mathbf{x},t) \, d \Sigma = Q_o= \pi R_o^2 \, \rho_e(mathbf{x},0).
# $$ 
# The outer distribution of electric field does not depend on time either (see figure \ref{efield}).
#
# \begin{figure}[htbp]
# \caption{\label{charge}Time evolution of the relative error of the charge per unit of length of cylinder as a function of the resolution. (\% Error =$|1-Q(t)/Q_o)|$ }
# \begin{center}
# \includegraphics[width=0.6\hsize]{charge.eps}
# \end{center}
# \end{figure}
#
# \begin{figure}[htbp]
# \caption{\label{efield} Electric field distribution at the steady state as a function of the resolution.}
# \begin{center}
# \includegraphics[width=0.8\hsize]{efield.eps}
# \end{center}
# \end{figure}
#
# Author: J.M. L\'opez-Herrera and S. Popinet
# Command: sh cylinder.sh cylinder.gfs
# Version: 100609
# Required files: cylinder.sh cylinder.gfs
# Running time: 15 seconds
# Generated files: charge.eps efield.eps 
#

GModule electrohydro

1 0 GfsElectroHydroAxi GfsBox GfsGEdge {} {
     Global {
     #define R0 0.1
     #define rhoinic 0.5
     #define K 3
     #define E1 3
     #define E2 1
    }
    Time { end = 15 dtmax=1.0 }

    VariableTracerVOF {} T
    InitFraction T (-y+R0)
    AdaptGradient{istep=1} {cmax=1e-4 minlevel=5 maxlevel=LEVEL} T
    PhysicalParams{L=1}   
    Init {} { Rhoe = rhoinic*T }  
 
    EventStop { istep = 10 } Ex 0.001 

    GfsSourceCharge Rhoe K*T   

#    OutputTime { istep = 1 } stderr
    OutputScalarSum { step = 1.0 } {
	awk '
	BEGIN { R0 = 0.1 ; rhoinic = 0.5 ; L =1.0 ; Q = 0.5*R0*R0*L*rhoinic }
	{ print $3,$5,100*sqrt((1.0-$5/Q)*(1.0-$5/Q))}' > rhoe-LEVEL } {v=Rhoe}
    OutputLocation {start=end} {awk '{if($1 != "#") print $3, $12 }' > prof-LEVEL} yprofile    
    OutputSimulation {start=end} result-LEVEL.gfs 
} {
    # Electric parameters
    perm = E1*T+E2*(1.-T)
    GfsElectricProjectionParams { tolerance = 1e-7 }
}
GfsBox {
   top   = Boundary{
                    BcDirichlet Phi  0
           }
   bottom = Boundary
}
